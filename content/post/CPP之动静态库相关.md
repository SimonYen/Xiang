---
title: "CPP之动静态库相关"
date: 2023-03-15T14:53:39+08:00
math: false
tags: ['gcc']
categories: ['CPP']
---

# 静态库

## 命名规则

**libxxx.a**

其中lib为前缀，.a为后缀，固定的。

xxx库的名字。

## 生成方法

通过gcc获得.o文件（-c 参数）

使用ar命令打包

```shell
ar rcs libxxx.a xxx.o xxx.o
```

- r-将文件插入备存文件中
- c-建立备存文件
- s-索引

## 使用方法

假设静态库的名字为xxx,所在路径为当前路径。

```shell
g++ main.cpp -lxxx -L.
```

# 动态库

## 命名规则

**libxxx.so**

其中lib为前缀，.so为后缀，固定的。

xxx库的名字。

## 生成方法

gcc得到与位置无关的代码

```shell
gcc -c -fpic a.c b.c
```

gcc得到动态库

```shell
gcc -shared a.o b.o -o libxxx.so
```

## 使用方法

编译方法同静态库，但是运行该程序时要添加环境变量

```bash
export LD_LIBRARY_PATH=程序动态库所在目录
```

# 两者对比

## 静态库的优缺点

### 优点

- 静态库被打包到应用程序中加载速度快
- 发布程序无需提供静态库，移植方便

### 缺点

- 消耗系统资源，浪费内存（不同程序用到同一个库的情况）
- 更新、部署、发布麻烦

## 动态库的优缺点

### 优点

- 可以实现进程间资源共享
- 更新、部署、发布简单
- 可以控制何时加载动态库

### 缺点

- 加载速度比静态库慢
- 发布程序时需要提供依赖的动态库
